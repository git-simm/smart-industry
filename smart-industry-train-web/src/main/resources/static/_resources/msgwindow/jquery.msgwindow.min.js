(function($){var defaults={WindowId:"defaultWindowId",ParentWindowId:null,WindowTitle:null,WindowPositionTop:"center",WindowPositionLeft:"center",WindowWidth:400,WindowHeight:300,WindowMinWidth:250,WindowMinHeight:0,WindowResizeMinWidth:250,WindowResizeMinHeight:0,WindowResizeMaxWidth:undefined,WindowResizeMaxHeight:undefined,WindowResizable:true,WindowMaximize:true,WindowMinimize:true,WindowClosable:true,WindowDraggable:true,WindowStatus:"regular",WindowAnimationSpeed:500,WindowAnimation:"easeOutCubic",content:"",contentBackground:null,contentBorder:null,contentPadding:null,contentOverflow:null,overlayBackground:"#000",overlayOpacity:0.4,containment:"body",WindowAdaptive:true,disabled:false,showOverlay:false,WindowClosableByEsc:false,beforeWindowClose:null,afterWindowClose:null,beforeWindowMaximize:null,afterWindowMaximize:null,beforeWindowMinimize:null,afterWindowMinimize:null,beforeWindowClose:null,afterWindowClose:null,beforeWindowRegular:null,afterWindowRegular:null,onWindowResize:null,beforeWindowResize:null,afterWindowResize:null,keyPress:null,windowWidthMargin:20,windowHeightMargin:50};var overlayCount=0;$.extend({MsgWindow:function(options){if(!arguments.callee._methodInited){$.extend(arguments.callee,{_methodInited:true,closeAll:function(){var $body=$("body"),windowCache=$body.data("msgWindowCache");if(windowCache){for(var id in windowCache){windowCache[id].close();delete windowCache[id]}}},get:function(windowId){var $body=$("body"),windowCache=$body.data("msgWindowCache");return windowCache&&windowCache[windowId]}})}var o=$.extend({},defaults,options);var $body=$("body"),windowCache=$body.data("msgWindowCache");if(!windowCache){windowCache={};$body.data("msgWindowCache",windowCache)}if(windowCache[o.WindowId]){windowCache[o.WindowId].close()}var WinRegBtn="",WinMinBtn,WinMaxBtn,WinCloseBtn,WinBtnLeftedge,WinBtnRightedge,WindowOverlay,Window,parentWindow,WindowContent;if(o.WindowMinimize){if(o.WindowMaximize||o.WindowClosable){WinMinBtn='<div class="WinBtnSet winmin"><a href="#" class="win-min-btn"></a><div class="win-btn-spacer"></div></div>';WinRegBtn='<div class="WinBtnSet winreg"><a href="#" class="win-reg-btn"></a><div class="win-btn-spacer"></div></div>'}else{WinMinBtn='<div class="WinBtnSet winmin"><a href="#" class="win-min-btn"></a></div>';WinRegBtn='<div class="WinBtnSet winreg"><a href="#" class="win-reg-btn"></a></div>'}}else{WinMinBtn=""}if(o.WindowMaximize){if(o.WindowClosable){WinMaxBtn='<div class="WinBtnSet winmax"><a href="#" class="win-max-btn"></a><div class="win-btn-spacer"></div></div>';WinRegBtn='<div class="WinBtnSet winreg"><a href="#" class="win-reg-btn"></a><div class="win-btn-spacer"></div></div>'}else{WinMaxBtn='<div class="WinBtnSet winmax"><a href="#" class="win-max-btn"></a></div>';WinRegBtn='<div class="WinBtnSet winreg"><a href="#" class="win-reg-btn"></a></div>'}}else{WinMaxBtn=""}if(o.WindowClosable){WinCloseBtn='<a href="#" class="win-close-btn"></a>'}else{WinCloseBtn=""}if(o.WindowMinimize||o.WindowMaximize||o.WindowClosable){WinBtnLeftedge='<div class="win-btn-leftedge"></div>';WinBtnRightedge='<div class="win-btn-rightedge"></div>'}else{WinBtnLeftedge="";WinBtnRightedge=""}Window=$('<div class="MsgWindow" id="'+o.WindowId+'" '+($.browser.msie?"":'tabindex="0"')+">"+'  <table cellpadding="0" cellspacing="0" border="0">'+"    <tr>"+'      <td class="table-tl"></td>'+'      <td class="table-tm"></td>'+'      <td class="table-tr"></td>'+"    </tr>"+"    <tr>"+'      <td class="table-lm"></td>'+'      <td class="table-mm" align="right">'+'        <div class="title"><nobr>'+o.WindowTitle+"</nobr></div>"+'        <div class="buttons">'+WinBtnLeftedge+WinMinBtn+WinMaxBtn+WinRegBtn+WinCloseBtn+WinBtnRightedge+"        </div>"+'        <div class="table-mm-container" align="left">'+'          <div class="table-mm-content" style="width: '+o.WindowWidth+'px;"/>'+'          <div class="iframeHelper"/>'+"        </div>"+"      </td>"+'      <td class="table-rm"></td>'+"    </tr>"+"    <tr>"+'      <td class="table-bl"></td>'+'      <td class="table-bm"></td>'+'      <td class="table-br"></td>'+"    </tr>"+"  </table>"+"</div>");o._$window=Window;parentWindow=o.ParentWindowId&&windowCache[o.ParentWindowId];if(parentWindow){parentWindow.data("_cache_disabled_status",{disabled:parentWindow.data("options").disabled,focus:parentWindow.is(".active")});parentWindow.setDisabled(true)}Window.data("options",o);if(o.WindowHeight==="auto"){WindowContent=$(o.content).css({width:o.WindowWidth}).appendTo("body");o.WindowHeight=WindowContent.height()+5;WindowContent.remove()}Window.find(".table-mm-content").css({border:o.contentBorder,padding:o.contentPadding,background:o.contentBackground,overflow:o.contentOverflow}).prepend(o.content);if(o.disabled){Window.find(".iframeHelper").show()}if(o.showOverlay){if(overlayCount++===0){WindowOverlay=$('<div class="MsgWindowOverlay"/>').appendTo($body)}else{WindowOverlay=$body.find(".MsgWindowOverlay")}WindowOverlay.css({background:o.overlayBackground,opacity:o.overlayOpacity});
Window.addClass("overlay")}Window.hide().appendTo($body);var WindowContainer=Window.find(".table-mm-container");var WindowContent=Window.find(".table-mm-content");var BTNMin=Window.find(".WinBtnSet.winmin");var BTNMax=Window.find(".WinBtnSet.winmax");var BTNReg=Window.find(".WinBtnSet.winreg");var BTNClose=Window.find(".win-close-btn");BTNReg.css("display","none");if(o.WindowPositionTop=="center"){o.WindowPositionTop=($(window).height()/2)-o.WindowHeight/2-37}if(o.WindowPositionLeft=="center"){o.WindowPositionLeft=($(window).width()/2)-o.WindowWidth/2-17}if(o.WindowPositionTop<0){o.WindowPositionTop=0}if(o.WindowPositionLeft<0){o.WindowPositionLeft=0}Window.css({left:o.WindowPositionLeft+150,top:o.WindowPositionTop}).show();if(!o.disabled){FocusWindow(Window)}switch(o.WindowStatus){case"regular":RegularWindow(o.beforeWindowRegular,o.afterWindowRegular);break;case"maximized":MaximizeWindow(o.beforeWindowMaximize,o.afterWindowMaximize);break;case"minimized":MinimizeWindow(o.beforeWindowMinimize,o.afterWindowMinimize);break;default:break}function MaximizeWindow(bck,ack){if($.isFunction(bck)){bck.call(Window,null)}WindowContainer.css("visibility","visible");BTNMax.css("display","none");BTNReg.css("display","block");BTNMin.css("display","block");WindowContent.animate({width:$(window).width()-getWindowWidthMargin(),height:$(window).height()-getWindowHeightMargin()},{queue:false,duration:o.WindowAnimationSpeed,easing:o.WindowAnimation});Window.animate({width:$(window).width(),height:$(window).height(),top:0,left:0},o.WindowAnimationSpeed,o.WindowAnimation,function(){if($.isFunction(ack)){ack.call(Window,null)}});o.WindowStatus="maximized";return(false)}function MinimizeWindow(bck,ack){if($.isFunction(bck)){bck.call(Window,null)}BTNReg.css("display","block");BTNMax.css("display","none");BTNMin.css("display","none");WindowContainer.css("visibility","hidden");WindowContent.animate({width:o.WindowMinWidth,height:o.WindowMinHeight},{queue:true,duration:o.WindowAnimationSpeed,easing:o.WindowAnimation});Window.animate({width:o.WindowMinWidth+getWindowWidthMargin(),height:o.WindowMinHeight+getWindowHeightMargin(),top:$(window).height()-77,left:$(window).width()-o.WindowMinWidth-getWindowWidthMargin()},o.WindowAnimationSpeed,o.WindowAnimation,function(){if($.isFunction(ack)){ack.call(Window,null)}});o.WindowStatus="minimized";return(false)}function RegularWindow(bck,ack){if($.isFunction(bck)){bck.call(Window,null)}if((typeof(o.WindowPositionLeft)=="string")&&(o.WindowPositionLeft.substring(0,1)=="-")){o.WindowPositionLeft=0}BTNMax.css("display","block");BTNReg.css("display","none");BTNMin.css("display","block");WindowContainer.css("visibility","visible");var ws=getWindowSize();Window.animate({top:o.WindowPositionTop,left:o.WindowPositionLeft,width:ws.ww,height:ws.wh},{queue:false,duration:o.WindowAnimationSpeed,easing:o.WindowAnimation,complete:function(){if($.isFunction(ack)){ack.call(Window,null)}}});WindowContent.animate({width:ws.ww-ws.mw,height:ws.wh-ws.mh},{queue:false,duration:o.WindowAnimationSpeed,easing:o.WindowAnimation});o.WindowStatus="regular";return false}function FocusWindow(Window,e){$(".MsgWindow").removeClass("active");if(Window.hasClass("MsgWindow")){Window.addClass("active")}var target=e&&e.target;if(target){target=$(target);if(target.is(":text")||target.is(":password")||target.is("textarea")||target.is("select")){return}}Window.each(function(){this.focus()})}function BlurWindow(Window){Window.removeClass("active").each(function(){this.blur()})}function CloseWindow(bck,ack){if(Window.is(":hidden")){return}if($.isFunction(bck)){bck.call(Window,null)}Window.remove();delete windowCache[o.WindowId];if(o.showOverlay&&--overlayCount==0){$body.find(".MsgWindowOverlay").remove()}var parentWindow=o.ParentWindowId&&windowCache[o.ParentWindowId];if(parentWindow){var parentWindowStatus=parentWindow.data("_cache_disabled_status");parentWindow.setDisabled(parentWindowStatus.disabled);parentWindow.removeData("_cache_disabled_status");if(parentWindowStatus.focus){FocusWindow(parentWindow)}}if($.isFunction(ack)){ack.call(Window,null)}Window.find("iframe").remove();$.isFunction(window.CollectGarbage)&&window.CollectGarbage()}function getWindowSize(){var mw=getWindowWidthMargin(),mh=getWindowHeightMargin(),ww=o.WindowWidth+mw,wh=o.WindowHeight+mh;if(o.WindowAdaptive){var $containment=$(o.containment),cw=$containment.width(),ch=$containment.height();ww=ww>cw?cw:ww;wh=wh>ch?ch:wh}return{ww:ww,wh:wh,mw:mw,mh:mh}}function getWindowWidthMargin(){var pl=getNumberFormString(WindowContent.css("padding-left")),pr=getNumberFormString(WindowContent.css("padding-right"));return o.windowWidthMargin+pl+pr}function getWindowHeightMargin(){var pt=getNumberFormString(WindowContent.css("padding-top")),pb=getNumberFormString(WindowContent.css("padding-bottom"));return o.windowHeightMargin+pt+pb}function getNumberFormString(str){var group=/(-?\d*\.?\d+)/.exec(str);return group?Number(group[1]):0}if(o.WindowMaximize){Window.dblclick(function(e){if(o.disabled){return
}var target=e&&e.target;if(target){target=$(target);if(target.is("#"+o.WindowId+" .table-mm-container *")){return}}switch(o.WindowStatus){case"regular":MaximizeWindow(o.beforeWindowMaximize,o.afterWindowMaximize);break;case"maximized":RegularWindow(o.beforeWindowRegular,o.afterWindowRegular);break;case"minimized":RegularWindow(o.beforeWindowRegular,o.afterWindowRegular);break;default:break}})}else{Window.dblclick(function(){if(o.disabled){return}switch(o.WindowStatus){case"maximized":RegularWindow(o.beforeWindowRegular,o.afterWindowRegular);break;case"minimized":RegularWindow(o.beforeWindowRegular,o.afterWindowRegular);break;default:break}})}BTNMin.click(function(){if(o.disabled){return}FocusWindow(Window);MinimizeWindow(o.beforeWindowMinimize,o.afterWindowMinimize);return false});BTNMax.click(function(){if(o.disabled){return}FocusWindow(Window);MaximizeWindow(o.beforeWindowMaximize,o.afterWindowMaximize);return false});BTNReg.click(function(){if(o.disabled){return}FocusWindow(Window);RegularWindow(o.beforeWindowRegular,o.afterWindowRegular);return false});BTNClose.click(function(){if(o.disabled){return}Window.close(o.beforeWindowClose,o.afterWindowClose);return(false)});if(o.WindowDraggable){Window.draggable({distance:3,containment:o.containment,cancel:".table-mm-content",start:function(){if(o.disabled){return false}FocusWindow(Window);Window.find(".iframeHelper").show()},drag:function(){var $this=$(this);WindowTop=-1*$this.offset().top;WindowLeft=-1*$this.offset().left;$this.css({backgroundPosition:WindowLeft+"px "+WindowTop+"px"})},stop:function(){o.WindowPositionTop=Window.css("top");o.WindowPositionLeft=Window.css("left");Window.find(".iframeHelper").hide()}})}Window.click(function(e){if(o.disabled){return}FocusWindow(Window,e)});Window.keydown(function(e){if(o.disabled){return}var keyCode=e.keyCode;if(o.WindowClosableByEsc&&keyCode===27){Window.close(o.beforeWindowClose,o.afterWindowClose)}$.isFunction(o.keyPress)&&o.keyPress.call(Window,keyCode)});$(".MsgWindowOverlay").keydown(function(e){var keyCode=e.keyCode,o=$(".MsgWindow.active").data("options");if(o){var w=o._$window;if(o.WindowClosableByEsc&&keyCode===27){w.close(o.beforeWindowClose,o.afterWindowClose)}$.isFunction(o.keyPress)&&o.keyPress.call(Window,keyCode)}});if(o.WindowResizable){Window.resizable({minHeight:o.WindowResizeMinHeight+getWindowHeightMargin(),minWidth:o.WindowResizeMinWidth+getWindowWidthMargin(),maxHeight:o.WindowResizeMaxHeight?o.WindowResizeMaxHeight+getWindowHeightMargin():undefined,maxWidth:o.WindowResizeMaxWidth?o.WindowResizeMaxWidth+getWindowWidthMargin():undefined,alsoResize:WindowContent,start:function(){if($.isFunction(o.beforeWindowResize)){o.beforeWindowResize.call(Window,null)}FocusWindow(Window);Window.find(".iframeHelper").show()},resize:function(){if($.isFunction(o.onWindowResize)){o.onWindowResize.call(Window,null)}},stop:function(){o.WindowWidth=WindowContent.width();o.WindowHeight=WindowContent.height();Window.find(".iframeHelper").hide();if($.isFunction(o.afterWindowResize)){o.afterWindowResize.call(Window,null)}}});Window.resizable(o.disabled?"disable":"enable")}windowCache[o.WindowId]=Window;return $.extend(Window,{close:CloseWindow,setDisabled:function(flag){BlurWindow(this);o.disabled=flag;if(flag){o.WindowResizable&&this.resizable("disable");this.find(".iframeHelper").show()}else{o.WindowResizable&&this.resizable("enable");this.find(".iframeHelper").hide()}}})},jAlert:function(options){var o=$.extend({WindowId:undefined,ParentWindowId:undefined,title:undefined,type:"info",btnText:" 确  定 ",content:"",containment:"body",WindowWidth:400,showOverlay:false,overlayOpacity:null,WindowDraggable:true,WindowResizable:false,WindowMaximize:false,WindowMinimize:false,WindowClosable:true,WindowClosableByEsc:true,callback:undefined},options);if(o.title===undefined){o.title={"info":"消息","warn":"警告","error":"错误","success":"成功","help":"帮助"}[o.type]||""}var $frame=$("<table><tr><td class='"+o.type+"-content-frame'></td></tr>"+"<tr><td class='btn-content'></td></tr></table>");var $content=$("<div class='"+o.type+"-content'/>");$content.css({width:o.WindowWidth-90}).append(o.content).appendTo("body");o.WindowHeight=$content.outerHeight()+75;$content.css("height",$content.height());$frame.find("."+o.type+"-content-frame").append($content.remove());var Window=$.MsgWindow({WindowId:o.WindowId,ParentWindowId:o.ParentWindowId,WindowTitle:o.title,WindowWidth:o.WindowWidth,WindowHeight:o.WindowHeight,content:$frame,containment:o.containment,showOverlay:o.showOverlay,overlayOpacity:o.overlayOpacity,WindowResizable:o.WindowResizable,WindowMaximize:o.WindowMaximize,WindowMinimize:o.WindowMinimize,WindowClosable:o.WindowClosable,WindowDraggable:o.WindowDraggable,WindowClosableByEsc:o.WindowClosableByEsc,keyPress:function(keyCode){if(keyCode===13){this.close();if($.isFunction(o.callback)){o.callback(true)}}},afterWindowClose:function(){if($.isFunction(o.callback)){o.callback(false)}}});$("<input type='button'>").val(o.btnText).click(function(){if($.isFunction(o.callback)){if(o.callback(true)!==false){Window.close()
}}else{Window.close()}}).appendTo($frame.find(".btn-content"));return Window},jConfirm:function(options){var o=$.extend({WindowId:undefined,ParentWindowId:undefined,title:"确认",yBtnText:" 确  定 ",nBtnText:" 取  消 ",content:"",containment:"body",WindowWidth:400,showOverlay:false,overlayOpacity:null,WindowDraggable:true,WindowResizable:false,WindowMaximize:false,WindowMinimize:false,WindowClosable:true,WindowClosableByEsc:true,callback:undefined},options);var $frame=$("<table><tr><td colspan='2' class='confirm-content-frame'></td></tr>"+"<tr><td class='ybtn-content'></td><td class='nbtn-content'></td></tr></table>");var $content=$("<div class='confirm-content'/>");$content.css({width:o.WindowWidth-90}).append(o.content).appendTo("body");o.WindowHeight=$content.outerHeight()+75;$content.css("height",$content.height());$frame.find(".confirm-content-frame").append($content.remove());var Window=$.MsgWindow({WindowId:o.WindowId,ParentWindowId:o.ParentWindowId,WindowTitle:o.title,WindowWidth:o.WindowWidth,WindowHeight:o.WindowHeight,content:$frame,containment:o.containment,showOverlay:o.showOverlay,overlayOpacity:o.overlayOpacity,WindowResizable:o.WindowResizable,WindowMaximize:o.WindowMaximize,WindowMinimize:o.WindowMinimize,WindowClosable:o.WindowClosable,WindowDraggable:o.WindowDraggable,WindowClosableByEsc:o.WindowClosableByEsc,keyPress:function(keyCode){if(keyCode===13){this.close();if($.isFunction(o.callback)){o.callback(true)}}},afterWindowClose:function(){if($.isFunction(o.callback)){o.callback(false)}}});$("<input type='button'>").val(o.yBtnText).click(function(){close(true)}).appendTo($frame.find(".ybtn-content"));$("<input type='button'>").val(o.nBtnText).click(function(){close(false)}).appendTo($frame.find(".nbtn-content"));function close(flag){if($.isFunction(o.callback)){if(o.callback(flag)!==false){Window.close()}}else{Window.close()}}return Window},jPrompt:function(options){var o=$.extend({WindowId:undefined,ParentWindowId:undefined,title:"提示",content:"请输入文本",value:"",isShowNBtn:true,yBtnText:" 确  定 ",nBtnText:" 取  消 ",containment:"body",WindowWidth:400,showOverlay:false,overlayOpacity:null,WindowDraggable:true,WindowResizable:false,WindowMaximize:false,WindowMinimize:false,WindowClosable:true,WindowClosableByEsc:true,callback:undefined},options);var $frame=$("<table><tr><td colspan='2' class='prompt-content-frame'></td></tr>"+(o.isShowNBtn?"<tr><td class='ybtn-content'></td><td class='nbtn-content'></td></tr>":"<tr><td class='obtn-content'></td></tr>")+"</table>");var $content=$("<div class='prompt-content'/>").append(o.content);var $input=$("<input/>").addClass("prompt-text").attr("type","text").val(o.value).appendTo($("<div/>").addClass("prompt-text-container").appendTo($content));$content.css({width:o.WindowWidth-90}).appendTo("body");o.WindowHeight=$content.outerHeight()+75;$content.css("height",$content.height());$frame.find(".prompt-content-frame").append($content.remove());var Window=$.MsgWindow({WindowId:o.WindowId,ParentWindowId:o.ParentWindowId,WindowTitle:o.title,WindowWidth:o.WindowWidth,WindowHeight:o.WindowHeight,content:$frame,containment:o.containment,showOverlay:o.showOverlay,overlayOpacity:o.overlayOpacity,WindowResizable:o.WindowResizable,WindowMaximize:o.WindowMaximize,WindowMinimize:o.WindowMinimize,WindowClosable:o.WindowClosable,WindowDraggable:o.WindowDraggable,WindowClosableByEsc:o.WindowClosableByEsc,keyPress:function(keyCode){if(keyCode===13){this.close();if($.isFunction(o.callback)){o.callback($input.val())}}},afterWindowClose:function(){if($.isFunction(o.callback)){o.callback(null)}}});if(o.isShowNBtn){$("<input type='button'>").val(o.yBtnText).click(function(){close(true)}).appendTo($frame.find(".ybtn-content"));$("<input type='button'>").val(o.nBtnText).click(function(){close(false)}).appendTo($frame.find(".nbtn-content"))}else{$("<input type='button'>").val(o.yBtnText).click(function(){close(true)}).appendTo($frame.find(".obtn-content"))}$input.trigger("select");function close(flag){if($.isFunction(o.callback)){if(o.callback(flag?$input.val():null)!==false){Window.close()}}else{Window.close()}}return Window}})})(jQuery);